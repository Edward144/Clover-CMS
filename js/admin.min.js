function sidebarcollapse(){if($(window).width()<768){var i=$(".wrapper > .main > .sidebar");i.hide().addClass("collapse-left"),i.on("transitionend",function(){i.show()})}}function responsive_filemanager_callback(i){var t=$("#"+i).val().split(root_dir)[1];$("input[name='"+i+"']").val(t).trigger("change")}function formbuilder_generaterandom(){return btoa((new Date).getTime()).split("=")[0]}function formbuilder_save(i,t="",e=!1){var n={};t=""==t?$(".formbuilder").first():t,n.formid=t.children(".list-group").children(".actions").find("input[name='formid']").val(),n.action=t.children(".list-group").children(".actions").find("input[name='action']").val(),n.method=t.children(".list-group").children(".actions").find("select[name='method']").val();var a=[],s=0;t.children(".list-group").children(".list-group-item:not(.actions)").each(function(){var i=[],t=0;$(this).children(".inputs").children(".input").each(function(){var e={};if($(this).find("input:not([type='button']):not([type='submit']), textarea, checkbox").each(function(){if(!$(this).parents(".list-group-item").first().hasClass("option")){var i=$(this).attr("name");if($(this).is(":checkbox"))if($(this).is(":checked"))var t=!0;else t=!1;else t=$(this).val();e[i]=t}}),$(this).find(".options").length){var n=[];$(this).find(".option").each(function(){if($(this).find(":radio").length){if($(this).find(":radio:checked").length)var i=!0;else i=!1;n.push({value:$(this).find("input[name='optionvalue']").first().val(),default:i})}else n.push({value:$(this).find("input[name='optionvalue']").first().val()})}),e.options=n}i[t]=e,t++}),a[s]={groupid:$(this).find("input[name='groupid']").first().val(),name:$(this).find("input[name='groupname']").first().val(),inputs:i},s++}),n.groups=a,1==e?console.log(n):i.val(JSON.stringify(n))}function formbuilder_addgroup(i){var t=$(".formbuilder").children(".groups").children(".group").length+1,e={groupid:formbuilder_generaterandom(),name:"Group "+t,inputs:[]};$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),data:JSON.stringify(e),method:"addGroup"},success:function(t){$(t).insertBefore(i.parents(".list-group-item").first()),formbuilder_disablesubmit()}})}function formbuilder_addinput(i,t="",e={}){e.type=""==t?i.siblings("select[name='inputType']").val():t,e.inputid=formbuilder_generaterandom(),$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),data:JSON.stringify(e),method:"addInput"},success:function(t){$(t).insertBefore(i.parents(".list-group-item").first()),formbuilder_disablesubmit()}})}function formbuilder_addoption_select(i){$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),method:"addOptionSelect"},success:function(t){$(t).insertBefore(i.parents(".list-group-item").first())}})}function formbuilder_addoption_radio(i){var t=i.parents(".list-group").first().children(".list-group-item:not(.actions)").length,e=i.parents(".input").first().find("input[name='inputid']").first().val();if(t>0)var n=!1;else n=!0;$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),inputId:e,isDefault:n,method:"addOptionRadio"},success:function(t){$(t).insertBefore(i.parents(".list-group-item").first())}})}function formbuilder_deleteitem(i){var t=i.val().split("Ã— ")[1].toLowerCase(),e=i.parents(".list-group").first(),n=i.parent(".input-group").find("input[type='radio']:checked").length;confirm("Are you sure you want to delete this "+t+"?")&&(i.parents(".list-group-item").first().remove(),"option"==t&&n>0&&e.find("input[type='radio']").first().prop("checked",!0),formbuilder_disablesubmit())}function formbuilder_disablesubmit(){$(".formbuilder").find("input[name='type'][value='submit']").length?($(".formbuilder select[name='inputType']").children("option[value='input_submit']").prop("disabled",!0),$(".formbuilder select[name='inputType']").children("option").prop("selected",!1)):$(".formbuilder select[name='inputType']").children("option[value='input_submit']").prop("disabled",!1)}$(".sidebar").on("click","#toggleSidebar",function(){var i=$(this).parents(".sidebar").first();i.hasClass("collapse-left")?i.removeClass("collapse-left"):i.addClass("collapse-left")}),$(document).ready(function(){sidebarcollapse()}),$("form").submit(function(){var i=!0;if($(this).find(".invalid-feedback").remove(),$(this).find(".is-invalid").removeClass("is-invalid"),$(this).find("input[name='password']").length&&$(this).find("input[name='passwordConf']").length){var t=$(this).find("input[name='password']"),e=$(this).find("input[name='passwordConf']");(t.val().length||e.val().length)&&(t.val().length<8?(t.addClass("is-invalid"),$("<div class='invalid-feedback'>Password must be at least 8 characters</div>").insertAfter(t),i=!1):/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])/.test(t.val())?t.val()!=e.val()&&(t.addClass("is-invalid"),e.addClass("is-invalid"),$("<div class='invalid-feedback'>Passwords do not match</div>").insertAfter(e),i=!1):(t.addClass("is-invalid"),$("<div class='invalid-feedback'>Password must contain at least one lowercase, one uppercase and one digit</div>").insertAfter(t),i=!1))}if($(this).find("input[name='url']").length){var n=$(this).find("input[name='url']");/^[a-zA-Z0-9\:\/\-\_\+\?\&\=\#\.]+$/.test(n.val())||(n.addClass("is-invalid"),$("<div class='invalid-feedback'>Url contains invalid characters. Allowed characters are A-Z, 0-9, :, /, -, _, +, ?, &, =, #, .</div>").insertAfter(n),i=!1)}0!=i||event.preventDefault()}),$("input[name='url']").keyup(function(){var i=$(this);i.removeClass("is-invalid"),i.siblings(".invalid-feedback").remove(),/^[a-zA-Z0-9\:\/\-\_\+\?\&\=\#\.]+$/.test(i.val())||(i.addClass("is-invalid"),$("<div class='invalid-feedback'>Url contains invalid characters. Allowed characters are A-Z, 0-9, :, /, -, _, +, ?, &, =, #, .</div>").insertAfter(i))}),$("input[type='submit'][data-confirm]").click(function(){confirm($(this).attr("data-confirm"))||event.preventDefault()}),$("input[name='clearSearch'],input[name='returnList']").click(function(){window.location.href=window.location.href.split("?")[0]}),$("input[name='deleteContent']").click(function(){var i=$(this);confirm("Are you sure you want to delete this content?")&&i.attr("data-id").length&&$.ajax({url:window.location.pathname,method:"post",dataType:"json",data:{id:$(this).attr("data-id"),method:"deleteContent"},success:function(t){if("success"==t.status)location.reload();else{var e="<div class='alert alert-"+t.status+"'>"+t.message+"</div>";i.parents("table").first().length>0?(i.parents("table").first().find(".alert").remove(),$(e).insertBefore(i.parents("table").first())):(i.parents("form").first().find(".alert").remove(),$(e).appendTo(i.parents("form").first()))}}})}),$(".countChars").keyup(function(){var i=$(this).attr("maxlength"),t=$(this).val().length;$(this).siblings("small.charCount").length?$(this).siblings("small.charCount").text(t+" of "+i):$("<small class='charCount d-block text-end'>"+t+" of "+i+"</small>").insertAfter($(this))}),$("#otherSettings").submit(function(){var i=!0,t=$(this).find("input[name='googleAnalytics']");t.val().length&&!/^[A-Z]{2}\-[0-9]{8}\-[0-9]$/.test(t.val())&&(t.addClass("is-invalid"),$("<div class='invalid-feedback'>Value does not appear to be valid</div>").insertAfter(t),i=!1),0!=i||event.preventDefault()}),$("select[name='chooseMenu']").change(function(){window.location.href=window.location.href.split("manage-navigation/")[0]+"manage-navigation/"+$(this).val()}),$("#insertNavigation select[name='existing']").change(function(){var i=$(this).children(":selected"),t=i.attr("data-name"),e=i.attr("data-url");$("#insertNavigation").find("input[name='name']").val(t),$("#insertNavigation").find("input[name='url']").val(e)}),$(".structure").on("click","button[name='edit']",function(){$(this).parents(".navigationLevel").first().find(".modal").first().modal("show")}),$(".structure").on("click","button[name='delete']",function(){confirm("Are you sure you want to delete this item?")&&($(this).parents(".navigationLevel").first().find("input[name='delete']").first().val(1),$(this).parents(".navigationLevel").first().hide())}),$(".structureItems").sortable({items:".navigationLevel",connectWith:".structureItems",dropOnEmpty:!0,stop:function(){$(".structure .navigationLevel").each(function(){var i=$(this).prevAll(".navigationLevel").length,t=$(this).find(".modal").first();if($(this).parent().is(".structure"))var e=0;else e=$(this).parents(".navigationLevel").first().attr("data-id");t.find("input[name='parent']").val(e),t.find("input[name='position']").val(i)})}}),$(".structure input[name='saveStructure']").click(function(){var i={},t=$(this),e=$(this).parents(".structure").first(),n=0;if(e.find(".alert").remove(),e.find(".navigationLevel").each(function(){var t=$(this).children(".modal").first();i[n]={id:t.find("input[name='id']").val(),name:t.find("input[name='name']").val(),url:t.find("input[name='url']").val(),visible:t.find("select[name='visible']").val(),parent:t.find("input[name='parent']").val(),position:t.find("input[name='position']").val(),delete:t.find("input[name='delete']").val()},n++}),e.find(".is-invalid").length||e.find(".invalid-feedback").length)return event.preventDefault(),void $("<div class='alert alert-danger mt-3'>You have entered invalid information. Please check your inputs and try again.</div>").insertAfter(t.parent(".form-group"));e.find("input[name='json']").val(JSON.stringify(i))}),$("#manageForm").submit(function(){formbuilder_save($(this).find("input[name='structure']"))}),$(".formbuilder").on("click","input[name='addGroup']",function(){formbuilder_addgroup($(this))}),$(".formbuilder").on("click","input[name='addInput']",function(){formbuilder_addinput($(this))}),$(".formbuilder").on("click","input[name='addOptionSelect']",function(){formbuilder_addoption_select($(this))}),$(".formbuilder").on("click","input[name='addOptionRadio']",function(){formbuilder_addoption_radio($(this))}),$(".formbuilder").on("click","input[name='deleteGroup'], input[name='deleteInput'], input[name='deleteOption']",function(){formbuilder_deleteitem($(this))}),$(document).ready(function(){formbuilder_disablesubmit()}),$("input[name='deleteForm']").click(function(){var i=$(this).attr("data-id");$(".contentInner").find(".alert").remove(),confirm("Are you sure you want to delete this form?")&&$.ajax({url:window.location.href,method:"post",dataType:"json",data:{id:i,deleteForm:!0},success:function(i){"success"==i.status?window.location.reload():$("<div class='alert alert-"+i.status+" mt-3'>"+i.deletemsg+"</div>").appendTo($(".contentInner > div:first-child"))}})});