function sidebarcollapse(){if($(window).width()<768){var t=$(".wrapper > .main > .sidebar");t.hide().addClass("collapse-left"),setTimeout(function(){t.show()},50)}}function responsive_filemanager_callback(t){var i=$("#"+t).val().split(root_dir)[1];$("input[name='"+t+"']").val(i).trigger("change")}function formbuilder_generaterandom(){return btoa((new Date).getTime()).split("=")[0]}function formbuilder_save(t,i="",e=!1){var n={};i=""==i?$(".formbuilder").first():i,n.formid=i.children(".list-group").children(".actions").find("input[name='formid']").val(),n.action=i.children(".list-group").children(".actions").find("input[name='action']").val(),n.method=i.children(".list-group").children(".actions").find("select[name='method']").val();var a=[],s=0;i.children(".list-group").children(".list-group-item:not(.actions)").each(function(){var t=[],i=0;$(this).children(".inputs").children(".input").each(function(){var e={};if($(this).find("input:not([type='button']):not([type='submit']), textarea, checkbox").each(function(){if(!$(this).parents(".list-group-item").first().hasClass("option")){var t=$(this).attr("name");if($(this).is(":checkbox"))if($(this).is(":checked"))var i=!0;else i=!1;else i=$(this).val();e[t]=i}}),$(this).find(".options").length){var n=[];$(this).find(".option").each(function(){if($(this).find(":radio").length){if($(this).find(":radio:checked").length)var t=!0;else t=!1;n.push({value:$(this).find("input[name='optionvalue']").first().val(),default:t})}else n.push({value:$(this).find("input[name='optionvalue']").first().val()})}),e.options=n}t[i]=e,i++}),a[s]={groupid:$(this).find("input[name='groupid']").first().val(),name:$(this).find("input[name='groupname']").first().val(),inputs:t},s++}),n.groups=a,1==e?console.log(n):t.val(JSON.stringify(n))}function formbuilder_addgroup(t){var i=$(".formbuilder").children(".groups").children(".group").length+1,e={groupid:formbuilder_generaterandom(),name:"Group "+i,inputs:[]};$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),data:JSON.stringify(e),method:"addGroup"},success:function(i){$(i).insertBefore(t.parents(".list-group-item").first()),formbuilder_disablesubmit()}})}function formbuilder_addinput(t,i="",e={}){e.type=""==i?t.siblings("select[name='inputType']").val():i,e.inputid=formbuilder_generaterandom(),$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),data:JSON.stringify(e),method:"addInput"},success:function(i){$(i).insertBefore(t.parents(".list-group-item").first()),formbuilder_disablesubmit()}})}function formbuilder_addoption_select(t){$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),method:"addOptionSelect"},success:function(i){$(i).insertBefore(t.parents(".list-group-item").first())}})}function formbuilder_addoption_radio(t){var i=t.parents(".list-group").first().children(".list-group-item:not(.actions)").length,e=t.parents(".input").first().find("input[name='inputid']").first().val();if(i>0)var n=!1;else n=!0;$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),inputId:e,isDefault:n,method:"addOptionRadio"},success:function(i){$(i).insertBefore(t.parents(".list-group-item").first())}})}function formbuilder_deleteitem(t){var i=t.val().split("Ã— ")[1].toLowerCase(),e=t.parents(".list-group").first(),n=t.parent(".input-group").find("input[type='radio']:checked").length;confirm("Are you sure you want to delete this "+i+"?")&&(t.parents(".list-group-item").first().remove(),"option"==i&&n>0&&e.find("input[type='radio']").first().prop("checked",!0),formbuilder_disablesubmit())}function formbuilder_disablesubmit(){$(".formbuilder").find("input[name='type'][value='submit']").length?($(".formbuilder select[name='inputType']").children("option[value='input_submit']").prop("disabled",!0),$(".formbuilder select[name='inputType']").children("option").prop("selected",!1)):$(".formbuilder select[name='inputType']").children("option[value='input_submit']").prop("disabled",!1)}$(".sidebar").on("click","#toggleSidebar",function(){var t=$(this).parents(".sidebar").first();t.hasClass("collapse-left")?t.removeClass("collapse-left"):t.addClass("collapse-left")}),$(document).ready(function(){sidebarcollapse()}),$("form").submit(function(){var t=!0;if($(this).find(".invalid-feedback").remove(),$(this).find(".is-invalid").removeClass("is-invalid"),$(this).find("input[name='password']").length&&$(this).find("input[name='passwordConf']").length){var i=$(this).find("input[name='password']"),e=$(this).find("input[name='passwordConf']");(i.val().length||e.val().length)&&(i.val().length<8?(i.addClass("is-invalid"),$("<div class='invalid-feedback'>Password must be at least 8 characters</div>").insertAfter(i),t=!1):/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])/.test(i.val())?i.val()!=e.val()&&(i.addClass("is-invalid"),e.addClass("is-invalid"),$("<div class='invalid-feedback'>Passwords do not match</div>").insertAfter(e),t=!1):(i.addClass("is-invalid"),$("<div class='invalid-feedback'>Password must contain at least one lowercase, one uppercase and one digit</div>").insertAfter(i),t=!1))}if($(this).find("input[name='url']").length){var n=$(this).find("input[name='url']");/^[a-zA-Z0-9\:\/\-\_\+\?\&\=\#\.]+$/.test(n.val())||(n.addClass("is-invalid"),$("<div class='invalid-feedback'>Url contains invalid characters. Allowed characters are A-Z, 0-9, :, /, -, _, +, ?, &, =, #, .</div>").insertAfter(n),t=!1)}0!=t||event.preventDefault()}),$("input[name='url']").keyup(function(){var t=$(this);t.removeClass("is-invalid"),t.siblings(".invalid-feedback").remove(),/^[a-zA-Z0-9\:\/\-\_\+\?\&\=\#\.]+$/.test(t.val())||(t.addClass("is-invalid"),$("<div class='invalid-feedback'>Url contains invalid characters. Allowed characters are A-Z, 0-9, :, /, -, _, +, ?, &, =, #, .</div>").insertAfter(t))}),$("input[type='submit'][data-confirm]").click(function(){confirm($(this).attr("data-confirm"))||event.preventDefault()}),$("input[name='clearSearch'],input[name='returnList']").click(function(){window.location.href=window.location.href.split("?")[0]}),$("input[name='deleteContent']").click(function(){var t=$(this);confirm("Are you sure you want to delete this content?")&&t.attr("data-id").length&&$.ajax({url:window.location.pathname,method:"post",dataType:"json",data:{id:$(this).attr("data-id"),method:"deleteContent"},success:function(i){if("success"==i.status)location.reload();else{var e="<div class='alert alert-"+i.status+"'>"+i.message+"</div>";t.parents("table").first().length>0?(t.parents("table").first().find(".alert").remove(),$(e).insertBefore(t.parents("table").first())):(t.parents("form").first().find(".alert").remove(),$(e).appendTo(t.parents("form").first()))}}})}),$(".countChars").keyup(function(){var t=$(this).attr("maxlength"),i=$(this).val().length;$(this).siblings("small.charCount").length?$(this).siblings("small.charCount").text(i+" of "+t):$("<small class='charCount d-block text-end'>"+i+" of "+t+"</small>").insertAfter($(this))}),$("#otherSettings").submit(function(){var t=!0,i=$(this).find("input[name='googleAnalytics']");i.val().length&&!/^[A-Z]{2}\-[0-9]{8}\-[0-9]$/.test(i.val())&&(i.addClass("is-invalid"),$("<div class='invalid-feedback'>Value does not appear to be valid</div>").insertAfter(i),t=!1),0!=t||event.preventDefault()}),$("select[name='chooseMenu']").change(function(){window.location.href=window.location.href.split("manage-navigation/")[0]+"manage-navigation/"+$(this).val()}),$("#insertNavigation select[name='existing']").change(function(){var t=$(this).children(":selected"),i=t.attr("data-name"),e=t.attr("data-url");$("#insertNavigation").find("input[name='name']").val(i),$("#insertNavigation").find("input[name='url']").val(e)}),$(".structure").on("click","button[name='edit']",function(){$(this).parents(".navigationLevel").first().find(".modal").first().modal("show")}),$(".structure").on("click","button[name='delete']",function(){confirm("Are you sure you want to delete this item?")&&($(this).parents(".navigationLevel").first().find("input[name='delete']").first().val(1),$(this).parents(".navigationLevel").first().hide())}),$(".structureItems").sortable({items:".navigationLevel",connectWith:".structureItems",dropOnEmpty:!0,stop:function(){$(".structure .navigationLevel").each(function(){var t=$(this).prevAll(".navigationLevel").length,i=$(this).find(".modal").first();if($(this).parent().is(".structure"))var e=0;else e=$(this).parents(".navigationLevel").first().attr("data-id");i.find("input[name='parent']").val(e),i.find("input[name='position']").val(t)})}}),$(".structure input[name='saveStructure']").click(function(){var t={},i=$(this),e=$(this).parents(".structure").first(),n=0;if(e.find(".alert").remove(),e.find(".navigationLevel").each(function(){var i=$(this).children(".modal").first();t[n]={id:i.find("input[name='id']").val(),name:i.find("input[name='name']").val(),url:i.find("input[name='url']").val(),visible:i.find("select[name='visible']").val(),parent:i.find("input[name='parent']").val(),position:i.find("input[name='position']").val(),delete:i.find("input[name='delete']").val()},n++}),e.find(".is-invalid").length||e.find(".invalid-feedback").length)return event.preventDefault(),void $("<div class='alert alert-danger mt-3'>You have entered invalid information. Please check your inputs and try again.</div>").insertAfter(i.parent(".form-group"));e.find("input[name='json']").val(JSON.stringify(t))}),$("#manageForm").submit(function(){formbuilder_save($(this).find("input[name='structure']"))}),$(".formbuilder").on("click","input[name='addGroup']",function(){formbuilder_addgroup($(this))}),$(".formbuilder").on("click","input[name='addInput']",function(){formbuilder_addinput($(this))}),$(".formbuilder").on("click","input[name='addOptionSelect']",function(){formbuilder_addoption_select($(this))}),$(".formbuilder").on("click","input[name='addOptionRadio']",function(){formbuilder_addoption_radio($(this))}),$(".formbuilder").on("click","input[name='deleteGroup'], input[name='deleteInput'], input[name='deleteOption']",function(){formbuilder_deleteitem($(this))}),$(document).ready(function(){formbuilder_disablesubmit()}),$("input[name='deleteForm']").click(function(){var t=$(this).attr("data-id");$(".contentInner").find(".alert").remove(),confirm("Are you sure you want to delete this form?")&&$.ajax({url:window.location.href,method:"post",dataType:"json",data:{id:t,deleteForm:!0},success:function(t){"success"==t.status?window.location.reload():$("<div class='alert alert-"+t.status+" mt-3'>"+t.deletemsg+"</div>").appendTo($(".contentInner > div:first-child"))}})}),$(".deleteRole").submit(function(){confirm("Are you sure you want to delete this role? All users set to this role will be changed to Standard users.")||event.preventDefault()});