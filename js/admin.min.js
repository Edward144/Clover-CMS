function sidebarcollapse(){if($(window).width()<768){var e=$(".wrapper > .main > .sidebar");e.hide().addClass("collapse-left"),setTimeout(function(){e.show()},70)}}function responsive_filemanager_callback(e){var t=$("#"+e).val();$("input[name='"+e+"']").val(t).trigger("change")}function formbuilder_generaterandom(){return btoa((new Date).getTime()).split("=")[0]}function formbuilder_save(e,t="",i=!1){var a={};t=""==t?$(".formbuilder").first():t,a.formid=t.children(".list-group").children(".actions").find("input[name='formid']").val(),a.action=t.children(".list-group").children(".actions").find("input[name='action']").val(),a.method=t.children(".list-group").children(".actions").find("select[name='method']").val();var n=[],s=0;t.children(".list-group").children(".list-group-item:not(.actions)").each(function(){var e=[],t=0;$(this).children(".inputs").children(".input").each(function(){var i={};if($(this).find("input:not([type='button']):not([type='submit']), textarea, checkbox").each(function(){if(!$(this).parents(".list-group-item").first().hasClass("option")){var e=$(this).attr("name");if($(this).is(":checkbox"))if($(this).is(":checked"))var t=!0;else t=!1;else t=$(this).val();i[e]=t}}),$(this).find(".options").length){var a=[];$(this).find(".option").each(function(){if($(this).find(":radio").length){if($(this).find(":radio:checked").length)var e=!0;else e=!1;a.push({value:$(this).find("input[name='optionvalue']").first().val(),default:e})}else a.push({value:$(this).find("input[name='optionvalue']").first().val()})}),i.options=a}e[t]=i,t++}),n[s]={groupid:$(this).find("input[name='groupid']").first().val(),name:$(this).find("input[name='groupname']").first().val(),inputs:e},s++}),a.groups=n,1==i?console.log(a):e.val(JSON.stringify(a))}function formbuilder_addgroup(e){var t=$(".formbuilder").children(".groups").children(".group").length+1,i={groupid:formbuilder_generaterandom(),name:"Group "+t,inputs:[]};$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),data:JSON.stringify(i),formbuilder_method:"addGroup"},success:function(t){$(t).insertBefore(e.parents(".list-group-item").first()),formbuilder_disablesubmit()}})}function formbuilder_addinput(e,t="",i={}){i.type=""==t?e.siblings("select[name='inputType']").val():t,i.inputid=formbuilder_generaterandom(),$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),data:JSON.stringify(i),formbuilder_method:"addInput"},success:function(t){$(t).insertBefore(e.parents(".list-group-item").first()),formbuilder_disablesubmit()}})}function formbuilder_addoption_select(e){$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),formbuilder_method:"addOptionSelect"},success:function(t){$(t).insertBefore(e.parents(".list-group-item").first())}})}function formbuilder_addoption_radio(e){var t=e.parents(".list-group").first().children(".list-group-item:not(.actions)").length,i=e.parents(".input").first().find("input[name='inputid']").first().val();if(t>0)var a=!1;else a=!0;$.ajax({url:root_dir+"includes/classes/formbuilder.class.php",method:"post",dataType:"json",data:{id:$(this).parent(".structure").first().find("input[name='formid']").val(),inputId:i,isDefault:a,formbuilder_method:"addOptionRadio"},success:function(t){$(t).insertBefore(e.parents(".list-group-item").first())}})}function formbuilder_deleteitem(e){var t=e.val().split("Ã— ")[1].toLowerCase(),i=e.parents(".list-group").first(),a=e.parent(".input-group").find("input[type='radio']:checked").length;confirm("Are you sure you want to delete this "+t+"?")&&(e.parents(".list-group-item").first().remove(),"option"==t&&a>0&&i.find("input[type='radio']").first().prop("checked",!0),formbuilder_disablesubmit())}function formbuilder_disablesubmit(){$(".formbuilder").find("input[name='type'][value='submit']").length?($(".formbuilder select[name='inputType']").children("option[value='input_submit']").prop("disabled",!0),$(".formbuilder select[name='inputType']").children("option").prop("selected",!1)):$(".formbuilder select[name='inputType']").children("option[value='input_submit']").prop("disabled",!1)}function carousel_loadcontrols(e){e.find(".carousel-item:not(.additionalSlide)").each(function(){$(this).find(".carouselControls").length||($("<div class='carouselControls'><button type='button' class='btn btn-dark' name='carouselImage' data-toggle='tooltip' data-placement='bottom' title='Choose Image'><span class='fas fa-image'></span></button><button type='button' class='btn btn-dark' name='carouselDelete' data-toggle='tooltip' data-placement='bottom' title='Delete Slide'><span class='fas fa-trash'></span></button></div>").prependTo($(this)),$("[data-toggle='tooltip']").tooltip()),carousel_checkimage($(this))})}function carousel_save(e){var t=$("input[name='carousel']");if(e.length&&t.length){var i=[],a=0;e.find(".carousel-item:not(.additionalSlide)").each(function(){var e=$(this).find("img.background").attr("src"),t=$(this).find("input[name='carouselTitle']").val(),n=$(this).find("input[name='carouselTagline']").val();i[a]={image:e,title:t,tagline:n},a++}),t.val(JSON.stringify(i))}else console.log("Err: Carousel cannot be saved")}function carousel_regen(e){var t=$("input[name='carousel']").val();$.ajax({url:window.location.pathname,method:"post",dataType:"json",data:{carouselid:e.attr("id").split("carousel")[1],carouseldata:t,method:"carouselRegen"},success:function(t){e.html($(t).html()),carousel_loadcontrols(e),$("input[name='carousel']").length>1&&$("input[name='carousel']").last().remove()}})}function carousel_addslide(e){var t=$("input[name='carousel']");if(e.length){carousel_save(e,t);var i=JSON.parse(t.val());i[i.length]={image:""},t.val(JSON.stringify(i)),carousel_regen(e),$(document).ajaxComplete(function(){e.find(".carousel-item.active").removeClass("active"),e.find(".carousel-item:not(.additionalSlide)").length?e.find(".carousel-item:not(.additionalSlide)").last().addClass("active"):e.find(".carousel-item").last().addClass("active")})}}function carousel_deleteslide(e){var t=$("input[name='carousel']"),i=e.parents(".carousel").first();confirm("Are you sure you want to delete this slide?")&&(e.remove(),$(".tooltip").remove(),carousel_save(i,t),carousel_regen(i))}function carousel_rf_callback(e){var t=$("#"+e).val();$("#img"+e).attr("src",t),$("#"+e).remove(),carousel_checkimage($("#"+e).parents(".carousel-item").first())}function carousel_selectimage(e){var t=btoa(new Date).split("=")[0];e.find("img.background").remove(),e.prepend("<input type='hidden' id='"+t+"' name='"+t+"'>"),e.prepend("<img src='' class='background' id='img"+t+"'>"),$.fancybox.open({src:"js/responsive_filemanager/filemanager/dialog.php?type=1&field_id="+t+"&callback=carousel_rf_callback",type:"iframe"})}function carousel_checkimage(e){var t=e.find("img.background");console.log(e.attr("class")),t.length&&t.attr("src").length&&!e.find(".carouselControls button[name='carouselImageH']").length&&e.find(".carouselControls button[name='carouselImageV']").length&&e.find(".carouselControls").prepend("<button type='button' class='btn btn-dark' name='carouselImageH' data-toggle='tooltip' data-placement='bottom' title='Image Horizontal'><span class='fas fa-arrows-alt-h'></span></button><button type='button' class='btn btn-dark' name='carouselImageV' data-toggle='tooltip' data-placement='bottom' title='Image Vertical'><span class='fas fa-arrows-alt-v'></span></button>")}$(".sidebar").on("click","#toggleSidebar",function(){var e=$(this).parents(".sidebar").first();e.hasClass("collapse-left")?e.removeClass("collapse-left"):e.addClass("collapse-left")}),$(document).ready(function(){sidebarcollapse()}),$("form").submit(function(){var e=!0;if($(this).find(".invalid-feedback").remove(),$(this).find(".is-invalid").removeClass("is-invalid"),$(this).find("input[name='password']").length&&$(this).find("input[name='passwordConf']").length){var t=$(this).find("input[name='password']"),i=$(this).find("input[name='passwordConf']");(t.val().length||i.val().length)&&(t.val().length<8?(t.addClass("is-invalid"),$("<div class='invalid-feedback'>Password must be at least 8 characters</div>").insertAfter(t),e=!1):/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])/.test(t.val())?t.val()!=i.val()&&(t.addClass("is-invalid"),i.addClass("is-invalid"),$("<div class='invalid-feedback'>Passwords do not match</div>").insertAfter(i),e=!1):(t.addClass("is-invalid"),$("<div class='invalid-feedback'>Password must contain at least one lowercase, one uppercase and one digit</div>").insertAfter(t),e=!1))}if($(this).find("input[name='url']").length){var a=$(this).find("input[name='url']");/^[a-zA-Z0-9\:\/\-\_\+\?\&\=\#\.]+$/.test(a.val())||(a.addClass("is-invalid"),$("<div class='invalid-feedback'>Url contains invalid characters. Allowed characters are A-Z, 0-9, :, /, -, _, +, ?, &, =, #, .</div>").insertAfter(a),e=!1)}0!=e||event.preventDefault()}),$("input[name='url']").keyup(function(){var e=$(this);e.removeClass("is-invalid"),e.siblings(".invalid-feedback").remove(),/^[a-zA-Z0-9\:\/\-\_\+\?\&\=\#\.]+$/.test(e.val())||(e.addClass("is-invalid"),$("<div class='invalid-feedback'>Url contains invalid characters. Allowed characters are A-Z, 0-9, :, /, -, _, +, ?, &, =, #, .</div>").insertAfter(e))}),$("input[type='submit'][data-confirm]").click(function(){confirm($(this).attr("data-confirm"))||event.preventDefault()}),$("input[name='clearSearch'],input[name='returnList']").click(function(){window.location.href=window.location.href.split("?")[0]}),$("input[name='deleteContent']").click(function(){var e=$(this);confirm("Are you sure you want to delete this content?")&&e.attr("data-id").length&&$.ajax({url:window.location.pathname,method:"post",dataType:"json",data:{id:$(this).attr("data-id"),method:"deleteContent"},success:function(t){if("success"==t.status)location.reload();else{var i="<div class='alert alert-"+t.status+"'>"+t.message+"</div>";e.parents("table").first().length>0?(e.parents("table").first().find(".alert").remove(),$(i).insertBefore(e.parents("table").first())):(e.parents("form").first().find(".alert").remove(),$(i).appendTo(e.parents("form").first()))}}})}),$(".countChars").keyup(function(){var e=$(this).attr("maxlength"),t=$(this).val().length;$(this).siblings("small.charCount").length?$(this).siblings("small.charCount").text(t+" of "+e):$("<small class='charCount d-block text-end'>"+t+" of "+e+"</small>").insertAfter($(this))}),$("#otherSettings").submit(function(){var e=!0,t=$(this).find("input[name='googleAnalytics']");t.val().length&&!/^[A-Z]{2}\-[0-9]{8}\-[0-9]$/.test(t.val())&&(t.addClass("is-invalid"),$("<div class='invalid-feedback'>Value does not appear to be valid</div>").insertAfter(t),e=!1),0!=e||event.preventDefault()}),$("select[name='chooseMenu']").change(function(){window.location.href=window.location.href.split("manage-navigation/")[0]+"manage-navigation/"+$(this).val()}),$("#insertNavigation select[name='existing']").change(function(){var e=$(this).children(":selected"),t=e.attr("data-name"),i=e.attr("data-url");$("#insertNavigation").find("input[name='name']").val(t),$("#insertNavigation").find("input[name='url']").val(i)}),$(".structure").on("click","button[name='edit']",function(){$(this).parents(".navigationLevel").first().find(".modal").first().modal("show")}),$(".structure").on("click","button[name='delete']",function(){confirm("Are you sure you want to delete this item?")&&($(this).parents(".navigationLevel").first().find("input[name='delete']").first().val(1),$(this).parents(".navigationLevel").first().hide())}),$(".structureItems").sortable({items:".navigationLevel",connectWith:".structureItems",dropOnEmpty:!0,stop:function(){$(".structure .navigationLevel").each(function(){var e=$(this).prevAll(".navigationLevel").length,t=$(this).find(".modal").first();if($(this).parent().is(".structure"))var i=0;else i=$(this).parents(".navigationLevel").first().attr("data-id");t.find("input[name='parent']").val(i),t.find("input[name='position']").val(e)})}}),$(".structure input[name='saveStructure']").click(function(){var e={},t=$(this),i=$(this).parents(".structure").first(),a=0;if(i.find(".alert").remove(),i.find(".navigationLevel").each(function(){var t=$(this).children(".modal").first();e[a]={id:t.find("input[name='id']").val(),name:t.find("input[name='name']").val(),url:t.find("input[name='url']").val(),visible:t.find("select[name='visible']").val(),parent:t.find("input[name='parent']").val(),position:t.find("input[name='position']").val(),delete:t.find("input[name='delete']").val()},a++}),i.find(".is-invalid").length||i.find(".invalid-feedback").length)return event.preventDefault(),void $("<div class='alert alert-danger mt-3'>You have entered invalid information. Please check your inputs and try again.</div>").insertAfter(t.parent(".form-group"));i.find("input[name='json']").val(JSON.stringify(e))}),$("#manageForm").submit(function(){formbuilder_save($(this).find("input[name='structure']"))}),$(".formbuilder").on("click","input[name='addGroup']",function(){formbuilder_addgroup($(this))}),$(".formbuilder").on("click","input[name='addInput']",function(){formbuilder_addinput($(this))}),$(".formbuilder").on("click","input[name='addOptionSelect']",function(){formbuilder_addoption_select($(this))}),$(".formbuilder").on("click","input[name='addOptionRadio']",function(){formbuilder_addoption_radio($(this))}),$(".formbuilder").on("click","input[name='deleteGroup'], input[name='deleteInput'], input[name='deleteOption']",function(){formbuilder_deleteitem($(this))}),$(document).ready(function(){formbuilder_disablesubmit()}),$("input[name='deleteForm']").click(function(){var e=$(this).attr("data-id");$(".contentInner").find(".alert").remove(),confirm("Are you sure you want to delete this form?")&&$.ajax({url:window.location.href,method:"post",dataType:"json",data:{id:e,deleteForm:!0},success:function(e){"success"==e.status?window.location.reload():$("<div class='alert alert-"+e.status+" mt-3'>"+e.deletemsg+"</div>").appendTo($(".contentInner > div:first-child"))}})}),$(".deleteRole").submit(function(){confirm("Are you sure you want to delete this role? All users set to this role will be changed to Standard users.")||event.preventDefault()}),$(document).ready(function(){$(".carousel.builder").length&&carousel_loadcontrols($(".carousel.builder"))}),$("#manageContent").submit(function(){$(this).find(".carousel.builder").length&&carousel_save($(this).find(".carousel.builder"))}),$("body").on("click","button[name='addCarousel']",function(){carousel_addslide($(this).parents(".carousel").first())}),$("body").on("click","button[name='carouselDelete']",function(){carousel_deleteslide($(this).parents(".carousel-item").first())}),$("body").on("click","button[name='carouselImage']",function(){carousel_selectimage($(this).parent(".carouselControls").siblings(".carousel-item-inner").first())});